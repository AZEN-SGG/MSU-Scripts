# LeakAnalyze Compiler Integration

Этот модуль интегрирует LeakAnalyze с системой компиляции, создавая копию компилятора как в ВУЗе.

## Установка

```bash
cd compiler
./install.sh
```

Скрипт автоматически:
1. Проверит наличие системных компиляторов gcc и g++
2. Скопирует библиотеки в `~/bogachev/bin/LeakAnalyze/`
3. Создаст обёртки для gcc и g++
4. Создаст/обновит `.bogachev_env`
5. Настроит автоматическую загрузку в `.bashrc`
6. Выполнит тестовую компиляцию

## Удаление

```bash
cd compiler
./uninstall.sh
```

Скрипт безопасно удалит все компоненты и создаст резервные копии.

## Использование

После установки компиляторы работают автоматически:

```bash
# Компиляция с LeakAnalyze (линковка)
gcc program.c -o program
g++ program.cpp -o program

# Компиляция без LeakAnalyze (только компиляция)
gcc -c program.c
g++ -c program.cpp
```

## Структура файлов

```
~/bogachev/bin/
├── LeakAnalyze/           # Программа LeakAnalyze
│   ├── LeakAnalyze        # Исполняемый файл
│   ├── libgcc_leaks_tracer.o
│   └── libgcc_leaks_rbtree.o
├── gcc                    # Обёртка для gcc
├── g++                    # Обёртка для g++
└── ... (другие bog_push скрипты)
```

## Логика работы обёрток

1. **Проверка флагов**: Если есть флаг `-c`, библиотеки не подставляются
2. **Справка/версия**: Флаги `-h`, `--help`, `-v`, `--version` передаются без изменений
3. **Линковка**: При финальной линковке автоматически добавляются:
   - Библиотеки LeakAnalyze
   - Wrap-флаги для malloc/free/operator new/delete

## Откат изменений

При ошибках скрипт автоматически:
- Восстанавливает оригинальные файлы из бэкапов
- Удаляет установленные компоненты
- Восстанавливает `.bogachev_env`

## Требования

- Системные компиляторы gcc и g++ в `/usr/bin/`
- Библиотеки в `compiler/libs/`
- Программа LeakAnalyze в `compiler/libs/`
